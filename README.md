# Client-Server Backup System

To implement the client-server backup system, two main files were created: client.c and server.c. When executed on two different machines, both the client and the server initialize a connection via raw sockets, implemented in the file rawSocketConnection.c. Then, the client waits for user commands, and the server only listens for incoming messages.

The client can execute two basic commands that do not involve communication between the machines. The first is cd, which allows the user to change the current directory to the directory passed as a parameter, provided it already exists. The second command is exit, which terminates the program on the client side.

The other implemented commands involve communication between the two machines. This communication occurs via socket and was implemented using a simplified version of the Kermit protocol. The procedure for sending a message can be summarized in a sequence of steps. The first is to create a packet that has as fields an 8-bit start delimiter, the data field size (6 bits), the message type (4 bits), the data field (up to 63 bytes), and a vertical parity field (8 bits). All these fields are stored in a packet_t variable through the makePacket function. Next, the machine sending the message stores the data in an unsigned char buffer, with a capacity of 67 bytes (63 for data plus 4 for the header). When a message with less than 63 bytes of data is sent, the unused space is filled with zeros. Finally, the machine sends the buffer to the receiver through the send function.

When the receiver gets a message via the recv function, it calls the checkIntegrity function to verify if the message is in order. This involves checking if the start marker is correct, if the sequence matches the expected one, and if the calculated VRC (vertical parity) matches the received one. The receiver then sends a confirmation message to the client, which can be an ACK (acceptance), a NACK (non-acceptance), or an error message. If the sequence of the received message is greater than expected or if the VRC is incorrect, a NACK is sent. Otherwise, the receiver sends an ACK.

In cases where the expected ACK is not received, i.e., the message was lost between the client and the server, the program identifies a timeout through the waitResponseTimeout function. While the confirmation is not received, the program tries to resend the previous message, waiting to receive the ACK again.

The setdir command can be used similarly to cd, except that the directory changed is the server's. For this, the client sends a type 4 packet containing the name of the directory to which the server should change in the data field. The server then attempts to change directories. If there is no directory with the name sent in the message, the server sends an error message to the client. Otherwise, it sends an ACK and the operation is completed.

The backup command is used to copy a file from the client's current directory to the server's current directory. For this, the glob function from the standard library is used to determine the quantity and names of the files that match the pattern passed as a parameter. If no files are returned, the program prints an error for the user. If only one file is returned, the client calls the makeBackup function. If more than one file is returned, the client calls the makeMultipleBackup function. In the makeBackup function, the file passed as a parameter is opened. Then, a type 0 message containing the name of the file to be backed up is sent. The program then divides the file's content into several 63-byte blocks, except for the last block, incrementing the sequence field so that the server can arrange the received information into a single file. After sending the last block, the client sends a type 9 message indicating the end of a file.

The makeMultipleBackup function is very similar, except that start (type 1) and end (type 10) messages for a group of files are sent. Between these messages, the makeBackup function is called for each file returned by glob. Upon receiving all messages, the server sends the appropriate confirmations, creates the files with the received names, and writes the received data to the files.

The restore command performs the reverse process of the backup. It retrieves one or more files passed as a parameter by the user. In the restoreBackup function, the client sends a type 3 message to the server, indicating that it wants to retrieve one or more files. Upon receiving the message, the server uses glob again to determine which files the user wants to retrieve. If the function returns no files, the server sends an error message to the client. Otherwise, for each file, the sendFile function, very similar to makeBackup, is called. Finally, the server sends a type 10 message, representing the end of a group of files.

The last implemented command is verify. It receives the name of a file as a parameter. The client sends a type 5 message to the server, which upon receiving it, calculates the MD5 of the file name, provided the file exists in the server's current directory. This calculation is performed using the MD5_Init, MD5_Update, and MD5_Final functions from the OpenSSL library. The 16 bytes returned by the function are then sent to the client. The client performs the same calculation for the same file on the local machine and checks if the returned MD5 matches the received one.
